{"ast":null,"code":"/** @internal */\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction createXMLHttpRequest() {\n  // If running in Babylon Native, then defer to the native XMLHttpRequest, which has the same public contract\n  if (typeof _native !== \"undefined\" && _native.XMLHttpRequest) {\n    return new _native.XMLHttpRequest();\n  } else {\n    return new XMLHttpRequest();\n  }\n}\n/**\n * Extended version of XMLHttpRequest with support for customizations (headers, ...)\n */\nexport class WebRequest {\n  constructor() {\n    this._xhr = createXMLHttpRequest();\n    this._requestURL = \"\";\n  }\n  _injectCustomRequestHeaders() {\n    if (this._shouldSkipRequestModifications(this._requestURL)) {\n      return;\n    }\n    for (const key in WebRequest.CustomRequestHeaders) {\n      const val = WebRequest.CustomRequestHeaders[key];\n      if (val) {\n        this._xhr.setRequestHeader(key, val);\n      }\n    }\n  }\n  _shouldSkipRequestModifications(url) {\n    return WebRequest.SkipRequestModificationForBabylonCDN && (url.includes(\"preview.babylonjs.com\") || url.includes(\"cdn.babylonjs.com\"));\n  }\n  /**\n   * Gets or sets a function to be called when loading progress changes\n   */\n  get onprogress() {\n    return this._xhr.onprogress;\n  }\n  set onprogress(value) {\n    this._xhr.onprogress = value;\n  }\n  /**\n   * Returns client's state\n   */\n  get readyState() {\n    return this._xhr.readyState;\n  }\n  /**\n   * Returns client's status\n   */\n  get status() {\n    return this._xhr.status;\n  }\n  /**\n   * Returns client's status as a text\n   */\n  get statusText() {\n    return this._xhr.statusText;\n  }\n  /**\n   * Returns client's response\n   */\n  get response() {\n    return this._xhr.response;\n  }\n  /**\n   * Returns client's response url\n   */\n  get responseURL() {\n    return this._xhr.responseURL;\n  }\n  /**\n   * Returns client's response as text\n   */\n  get responseText() {\n    return this._xhr.responseText;\n  }\n  /**\n   * Gets or sets the expected response type\n   */\n  get responseType() {\n    return this._xhr.responseType;\n  }\n  set responseType(value) {\n    this._xhr.responseType = value;\n  }\n  /**\n   * Gets or sets the timeout value in milliseconds\n   */\n  get timeout() {\n    return this._xhr.timeout;\n  }\n  set timeout(value) {\n    this._xhr.timeout = value;\n  }\n  addEventListener(type, listener, options) {\n    this._xhr.addEventListener(type, listener, options);\n  }\n  removeEventListener(type, listener, options) {\n    this._xhr.removeEventListener(type, listener, options);\n  }\n  /**\n   * Cancels any network activity\n   */\n  abort() {\n    this._xhr.abort();\n  }\n  /**\n   * Initiates the request. The optional argument provides the request body. The argument is ignored if request method is GET or HEAD\n   * @param body defines an optional request body\n   */\n  send(body) {\n    if (WebRequest.CustomRequestHeaders) {\n      this._injectCustomRequestHeaders();\n    }\n    this._xhr.send(body);\n  }\n  /**\n   * Sets the request method, request URL\n   * @param method defines the method to use (GET, POST, etc..)\n   * @param url defines the url to connect with\n   */\n  open(method, url) {\n    for (const update of WebRequest.CustomRequestModifiers) {\n      if (this._shouldSkipRequestModifications(url)) {\n        return;\n      }\n      update(this._xhr, url);\n    }\n    // Clean url\n    url = url.replace(\"file:http:\", \"http:\");\n    url = url.replace(\"file:https:\", \"https:\");\n    this._requestURL = url;\n    return this._xhr.open(method, url, true);\n  }\n  /**\n   * Sets the value of a request header.\n   * @param name The name of the header whose value is to be set\n   * @param value The value to set as the body of the header\n   */\n  setRequestHeader(name, value) {\n    this._xhr.setRequestHeader(name, value);\n  }\n  /**\n   * Get the string containing the text of a particular header's value.\n   * @param name The name of the header\n   * @returns The string containing the text of the given header name\n   */\n  getResponseHeader(name) {\n    return this._xhr.getResponseHeader(name);\n  }\n}\n/**\n * Custom HTTP Request Headers to be sent with XMLHttpRequests\n * i.e. when loading files, where the server/service expects an Authorization header\n */\nWebRequest.CustomRequestHeaders = {};\n/**\n * Add callback functions in this array to update all the requests before they get sent to the network\n */\nWebRequest.CustomRequestModifiers = new Array();\nWebRequest.SkipRequestModificationForBabylonCDN = true;","map":{"version":3,"mappings":"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","names":["createXMLHttpRequest","_native","XMLHttpRequest","WebRequest","constructor","_injectCustomRequestHeaders","_shouldSkipRequestModifications","_requestURL","key","CustomRequestHeaders","val","_xhr","setRequestHeader","url","SkipRequestModificationForBabylonCDN","includes","onprogress","value","readyState","status","statusText","response","responseURL","responseText","responseType","timeout","addEventListener","type","listener","options","removeEventListener","abort","send","body","open","method","update","CustomRequestModifiers","replace","name","getResponseHeader","Array"],"sourceRoot":"","sources":["../../../../lts/core/generated/Misc/webRequest.ts"],"sourcesContent":["import type { IWebRequest } from \"./interfaces/iWebRequest\";\r\nimport type { Nullable } from \"../types\";\r\nimport type { INative } from \"../Engines/Native/nativeInterfaces\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\ndeclare const _native: INative;\r\n\r\n/** @internal */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nfunction createXMLHttpRequest(): XMLHttpRequest {\r\n    // If running in Babylon Native, then defer to the native XMLHttpRequest, which has the same public contract\r\n    if (typeof _native !== \"undefined\" && _native.XMLHttpRequest) {\r\n        return new _native.XMLHttpRequest();\r\n    } else {\r\n        return new XMLHttpRequest();\r\n    }\r\n}\r\n\r\n/**\r\n * Extended version of XMLHttpRequest with support for customizations (headers, ...)\r\n */\r\nexport class WebRequest implements IWebRequest {\r\n    private readonly _xhr = createXMLHttpRequest();\r\n\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    public static CustomRequestHeaders: { [key: string]: string } = {};\r\n\r\n    /**\r\n     * Add callback functions in this array to update all the requests before they get sent to the network\r\n     */\r\n    public static CustomRequestModifiers = new Array<(request: XMLHttpRequest, url: string) => void>();\r\n\r\n    public static SkipRequestModificationForBabylonCDN = true;\r\n\r\n    private _requestURL: string = \"\";\r\n\r\n    private _injectCustomRequestHeaders(): void {\r\n        if (this._shouldSkipRequestModifications(this._requestURL)) {\r\n            return;\r\n        }\r\n        for (const key in WebRequest.CustomRequestHeaders) {\r\n            const val = WebRequest.CustomRequestHeaders[key];\r\n            if (val) {\r\n                this._xhr.setRequestHeader(key, val);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _shouldSkipRequestModifications(url: string): boolean {\r\n        return WebRequest.SkipRequestModificationForBabylonCDN && (url.includes(\"preview.babylonjs.com\") || url.includes(\"cdn.babylonjs.com\"));\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a function to be called when loading progress changes\r\n     */\r\n    public get onprogress(): ((this: XMLHttpRequest, ev: ProgressEvent) => any) | null {\r\n        return this._xhr.onprogress;\r\n    }\r\n\r\n    public set onprogress(value: ((this: XMLHttpRequest, ev: ProgressEvent) => any) | null) {\r\n        this._xhr.onprogress = value;\r\n    }\r\n\r\n    /**\r\n     * Returns client's state\r\n     */\r\n    public get readyState(): number {\r\n        return this._xhr.readyState;\r\n    }\r\n\r\n    /**\r\n     * Returns client's status\r\n     */\r\n    public get status(): number {\r\n        return this._xhr.status;\r\n    }\r\n\r\n    /**\r\n     * Returns client's status as a text\r\n     */\r\n    public get statusText(): string {\r\n        return this._xhr.statusText;\r\n    }\r\n\r\n    /**\r\n     * Returns client's response\r\n     */\r\n    public get response(): any {\r\n        return this._xhr.response;\r\n    }\r\n\r\n    /**\r\n     * Returns client's response url\r\n     */\r\n    public get responseURL(): string {\r\n        return this._xhr.responseURL;\r\n    }\r\n\r\n    /**\r\n     * Returns client's response as text\r\n     */\r\n    public get responseText(): string {\r\n        return this._xhr.responseText;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the expected response type\r\n     */\r\n    public get responseType(): XMLHttpRequestResponseType {\r\n        return this._xhr.responseType;\r\n    }\r\n\r\n    public set responseType(value: XMLHttpRequestResponseType) {\r\n        this._xhr.responseType = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the timeout value in milliseconds\r\n     */\r\n    public get timeout(): number {\r\n        return this._xhr.timeout;\r\n    }\r\n\r\n    public set timeout(value: number) {\r\n        this._xhr.timeout = value;\r\n    }\r\n\r\n    /** @internal */\r\n    public addEventListener<K extends keyof XMLHttpRequestEventMap>(\r\n        type: K,\r\n        listener: (this: XMLHttpRequest, ev: XMLHttpRequestEventMap[K]) => any,\r\n        options?: boolean | AddEventListenerOptions\r\n    ): void;\r\n    public addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\r\n        this._xhr.addEventListener(type, listener, options);\r\n    }\r\n\r\n    /** @internal */\r\n    public removeEventListener<K extends keyof XMLHttpRequestEventMap>(\r\n        type: K,\r\n        listener: (this: XMLHttpRequest, ev: XMLHttpRequestEventMap[K]) => any,\r\n        options?: boolean | EventListenerOptions\r\n    ): void;\r\n    public removeEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void {\r\n        this._xhr.removeEventListener(type, listener, options);\r\n    }\r\n\r\n    /**\r\n     * Cancels any network activity\r\n     */\r\n    public abort() {\r\n        this._xhr.abort();\r\n    }\r\n\r\n    /**\r\n     * Initiates the request. The optional argument provides the request body. The argument is ignored if request method is GET or HEAD\r\n     * @param body defines an optional request body\r\n     */\r\n    public send(body?: Document | XMLHttpRequestBodyInit | null): void {\r\n        if (WebRequest.CustomRequestHeaders) {\r\n            this._injectCustomRequestHeaders();\r\n        }\r\n\r\n        this._xhr.send(body);\r\n    }\r\n\r\n    /**\r\n     * Sets the request method, request URL\r\n     * @param method defines the method to use (GET, POST, etc..)\r\n     * @param url defines the url to connect with\r\n     */\r\n    public open(method: string, url: string): void {\r\n        for (const update of WebRequest.CustomRequestModifiers) {\r\n            if (this._shouldSkipRequestModifications(url)) {\r\n                return;\r\n            }\r\n            update(this._xhr, url);\r\n        }\r\n\r\n        // Clean url\r\n        url = url.replace(\"file:http:\", \"http:\");\r\n        url = url.replace(\"file:https:\", \"https:\");\r\n\r\n        this._requestURL = url;\r\n\r\n        return this._xhr.open(method, url, true);\r\n    }\r\n\r\n    /**\r\n     * Sets the value of a request header.\r\n     * @param name The name of the header whose value is to be set\r\n     * @param value The value to set as the body of the header\r\n     */\r\n    setRequestHeader(name: string, value: string): void {\r\n        this._xhr.setRequestHeader(name, value);\r\n    }\r\n\r\n    /**\r\n     * Get the string containing the text of a particular header's value.\r\n     * @param name The name of the header\r\n     * @returns The string containing the text of the given header name\r\n     */\r\n    getResponseHeader(name: string): Nullable<string> {\r\n        return this._xhr.getResponseHeader(name);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}